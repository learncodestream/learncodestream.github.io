<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Publishing Preserved Artifacts - Learn Code Stream</title><meta name=description content="VMware vRealize Automation"><meta name=generator content="Hugo 0.83.1"><link href=https://learncodestream.github.io/index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://learncodestream.github.io/Getting-Started/Publishing-Preserved-Artifacts/><link rel=stylesheet href=https://learncodestream.github.io/css/theme.css><link rel=stylesheet href=/css/lightbox.min.css><link rel=stylesheet href=/css/custom.css><script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script><link rel=stylesheet href=https://learncodestream.github.io/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script><script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script src=https://learncodestream.github.io/js/bundle.js></script><script src=/js/lightbox.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-NN4VBNXV6M"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-NN4VBNXV6M')</script><style>:root{--custom-font-color:#0065ab;--custom-background-color:#FFFFFF}</style><meta property="og:title" content="Publishing Preserved Artifacts"><meta property="og:description" content="With the CI task  in a Code Stream Pipeline, it&rsquo;s possible to Preserve Artifacts  - any file that you want to persist beyond the lifetime of a Pipeline Execution  can be added to the Preserve Artifacts field. These preserved artifacts are stored on the Shared Path on the Docker Host , which you can access later using the file path specified in the CI task outputs. One of the issues with this is that the Shared Path is also where the pipeline execution logs are kept, which may contain sensitive information if you&rsquo;re not using Secret Variables , and to deliver a preserved file to an end user you may need to grant SSH access to your host - not ideal."><meta property="og:type" content="article"><meta property="og:url" content="https://learncodestream.github.io/Getting-Started/Publishing-Preserved-Artifacts/"><meta property="og:image" content="https://learncodestream.github.io/images/vra-code-stream-logo.png"><meta property="article:section" content="Getting Started"><meta property="article:modified_time" content="2021-05-14T10:22:16+01:00"><meta property="og:site_name" content="Learn Code Stream"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://learncodestream.github.io/images/vra-code-stream-logo.png"><meta name=twitter:title content="Publishing Preserved Artifacts"><meta name=twitter:description content="With the CI task  in a Code Stream Pipeline, it&rsquo;s possible to Preserve Artifacts  - any file that you want to persist beyond the lifetime of a Pipeline Execution  can be added to the Preserve Artifacts field. These preserved artifacts are stored on the Shared Path on the Docker Host , which you can access later using the file path specified in the CI task outputs. One of the issues with this is that the Shared Path is also where the pipeline execution logs are kept, which may contain sensitive information if you&rsquo;re not using Secret Variables , and to deliver a preserved file to an end user you may need to grant SSH access to your host - not ideal."><meta itemprop=name content="Publishing Preserved Artifacts"><meta itemprop=description content="With the CI task  in a Code Stream Pipeline, it&rsquo;s possible to Preserve Artifacts  - any file that you want to persist beyond the lifetime of a Pipeline Execution  can be added to the Preserve Artifacts field. These preserved artifacts are stored on the Shared Path on the Docker Host , which you can access later using the file path specified in the CI task outputs. One of the issues with this is that the Shared Path is also where the pipeline execution logs are kept, which may contain sensitive information if you&rsquo;re not using Secret Variables , and to deliver a preserved file to an end user you may need to grant SSH access to your host - not ideal."><meta itemprop=dateModified content="2021-05-14T10:22:16+01:00"><meta itemprop=wordCount content="537"><meta itemprop=image content="https://learncodestream.github.io/images/vra-code-stream-logo.png"><meta itemprop=keywords content></head><body><div class=container><header><div class=header-image><img src=/images/vra-code-stream-logo.png alt="Learn Code Stream"></div><div class=header><div class=header-h1><h1 class=header-h1>Learn Code Stream</h1></div><div class=header-description><p class=description>VMware vRealize Automation</p></div></div></header><div class=content-container><main><h1>Publishing Preserved Artifacts</h1><p>With the <a href=/Pipelines/Tasks/CI/>CI task</a> in a Code Stream Pipeline, it&rsquo;s possible to <a href=/Pipelines/Tasks/CI/#preserve-artifacts>Preserve Artifacts</a> - any file that you want to persist beyond the lifetime of a <a href=/Executions/>Pipeline Execution</a> can be added to the Preserve Artifacts field. These preserved artifacts are stored on the Shared Path on the <a href=/Configure/Endpoints/Docker/>Docker Host
</a>, which you can access later using the file path specified in the CI task outputs. One of the issues with this is that the Shared Path is also where the pipeline execution logs are kept, which may contain sensitive information if you&rsquo;re not using <a href=/Configure/variables/>Secret Variables
</a>, and to deliver a preserved file to an end user you may need to grant SSH access to your host - not ideal.</p><p>In order allow my end users to download a preserved artifact without granting them SSH access to my Docker host, I will publish the Shared Path using NGINX.</p><p>I&rsquo;ve already got an SSL certificate and key (<code>cmbu.local.crt.pem</code> and <code>cmbu.local.key.pem</code>) to provide SSL access to my host.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># Install NGINX</span>
sudo apt-get update
sudo apt install nginx
<span class=c1># Configure the firewall for SSL</span>
sudo ufw allow <span class=s1>&#39;Nginx HTTPS&#39;</span>
<span class=c1># Disable the default website</span>
sudo rm /etc/nginx/sites-enabled/default
<span class=c1># Create the SSL folder and move the certificates in</span>
sudo mkdir -p /etc/nginx/ssl
sudo chmod <span class=m>600</span> /etc/nginx/ssl
sudo cp ~/cmbu.local.crt.pem /etc/nginx/ssl/
sudo cp ~/cmbu.local.kry.pem /etc/nginx/ssl/
</code></pre></div><p>Next I want to publish the Shared Path configured in my Docker Endpoint - this defaults to <code>/sharedPath</code> but it can be any path on your Docker host. This is where the preserved artifacts will be saved - but it&rsquo;s also where the logs for the pipeline execution are saved too, so I want to only expose the contents of &ldquo;artifacts&rdquo; folders. To do this I will use a RegEx match in the location block of my NGINX site configuration.</p><p>To publish the <code>/sharedPath</code> folder, I create a site configuration in the sites-available folder: <code>/etc/nginx/sites-available/&lt;site name></code> with the configuration below - I&rsquo;ve annotated the configuration:</p><div class=highlight><pre class=chroma><code class=language-nginx data-lang=nginx><span class=k>server</span> <span class=p>{</span>
        <span class=kn>listen</span> <span class=mi>443</span> <span class=s>default</span> <span class=s>ssl</span><span class=p>;</span> <span class=c1># Listen on port 443 using HTTPS
</span><span class=c1></span>        <span class=kn>server_name</span> <span class=s>smcg-sc2-docker-host.cmbu.local</span><span class=p>;</span> <span class=c1># My docker host&#39;s FQDN
</span><span class=c1></span>        <span class=kn>ssl_certificate</span> <span class=s>/etc/nginx/ssl/cmbu.local.crt.pem</span><span class=p>;</span> <span class=c1># SSL Certificate
</span><span class=c1></span>        <span class=kn>ssl_certificate_key</span> <span class=s>/etc/nginx/ssl/cmbu.local.key.pem</span><span class=p>;</span> <span class=c1># SSL Private Key
</span><span class=c1></span>        <span class=kn>location</span> <span class=p>~</span><span class=sr>*</span> <span class=s>/artifacts/</span> <span class=p>{</span> <span class=c1># RegEx location to only allow paths with &#34;artifacts&#34; in the path
</span><span class=c1></span>                <span class=kn>root</span> <span class=s>/sharedPath</span><span class=p>;</span> <span class=c1># Serve files from the sharedPath (configured in the Docker Endpoint)
</span><span class=c1></span>                <span class=kn>rewrite</span> <span class=s>^/sharedPath(/.*)</span>$ <span class=nv>$1</span> <span class=s>last</span><span class=p>;</span> <span class=c1># Re-write &#34;/sharedPath/&#34; as the artifact path includes it
</span><span class=c1></span>        <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>Next I can enable the site config, test the config and then restart NGINX to make it live:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>sudo ln -s /etc/nginx/sites-available/smcg-sc2-docker-host.cmbu.local /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
</code></pre></div><p>At this point I should be able to access pipeline artifacts using the artifact output path, but I should also get a <code>HTTP 404</code> for any URL that doesn&rsquo;t include <code>/artifacts/</code>.</p><p>To test this I&rsquo;ve created a simple pipeline with a CI task that writes and preserves a file called &ldquo;preserve.txt&rdquo;:</p><div class=clr-content-image-wrap><a href=preserve-file.png data-lightbox=page-images data-title="Preserve an artifact"><img src=preserve-file.png alt="Preserve an artifact"></a><figcaption class=clr-caption>Preserve an artifact</figcaption></div><p>I&rsquo;ve also configured an email notification to send a link to the requesting user on successful execution of the pipeline:</p><div class=clr-content-image-wrap><a href=preserve-notification.png data-lightbox=page-images data-title="Email a link to the artifact"><img src=preserve-notification.png alt="Email a link to the artifact"></a><figcaption class=clr-caption>Email a link to the artifact</figcaption></div><p>When the pipeline is executed, I recieve the notification:</p><div class=clr-content-image-wrap><a href=preserve-email.png data-lightbox=page-images data-title="Email notification"><img src=preserve-email.png alt="Email notification"></a><figcaption class=clr-caption>Email notification</figcaption></div><p>And I can access the preserved file via the link:</p><div class=clr-content-image-wrap><a href=preserve-download.png data-lightbox=page-images data-title="Downloading the preserved file"><img src=preserve-download.png alt="Downloading the preserved file"></a><figcaption class=clr-caption>Downloading the preserved file</figcaption></div><div class=edit-meta>Last updated on 14 May 2021<br><a href=https://github.com/cmbu-tmm-sites/learncodestream/edit/main/content/Getting%20Started/Publishing%20Preserved%20Artifacts/index.md class=edit-page><i class="fas fa-pen-square"></i>&nbsp;Edit on GitHub</a></div><nav class=pagination><a class="nav nav-prev" href=https://learncodestream.github.io/Getting-Started/ title="Getting Started"><i class="fas fa-arrow-left" aria-hidden=true></i>&nbsp;Prev - Getting Started</a>
<a class="nav nav-next" href=https://learncodestream.github.io/Getting-Started/Slack-Notifications/ title="Slack Notifications">Next - Slack Notifications <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme adapted from <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><nav class=slide-menu><ul><li><a href=https://learncodestream.github.io>Home</a></li><li class="parent has-sub-menu"><a href=https://learncodestream.github.io/Getting-Started/>Getting Started<span class="mark opened">-</span></a><ul class=sub-menu><li class=active><a href=https://learncodestream.github.io/Getting-Started/Publishing-Preserved-Artifacts/>Publishing Preserved Artifacts</a></li><li><a href=https://learncodestream.github.io/Getting-Started/Slack-Notifications/>Slack Notifications</a></li></ul></li><li><a href=https://learncodestream.github.io/Dashboards/>Dashboards</a></li><li><a href=https://learncodestream.github.io/Executions/>Executions</a></li><li><a href=https://learncodestream.github.io/User-Operations/>User Operations</a></li><li class=has-sub-menu><a href=https://learncodestream.github.io/Pipelines/>Pipelines<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/Pipelines/Stages/>Stages</a></li><li class=has-sub-menu><a href=https://learncodestream.github.io/Pipelines/Tasks/>Tasks<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/Pipelines/Tasks/bamboo/>Bamboo</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/CI/>CI</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/Condition/>Condition</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/Custom/>Custom</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/Jenkins/>Jenkins</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/Kubernetes/>Kubernetes</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/Pipeline/>Pipeline</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/Poll/>Poll</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/PowerShell/>PowerShell</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/REST/>REST</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/SSH/>SSH</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/User-Operation/>User Operation</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/Cloud-Template/>VMware Cloud Template</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/vRealize-Orchestrator/>vRealize Orchestrator</a></li></ul></li></ul></li><li><a href=https://learncodestream.github.io/Custom-Integrations/>Custom Integrations</a></li><li class=has-sub-menu><a href=https://learncodestream.github.io/Configure/>Configure<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/Configure/Projects/>Projects</a></li><li class=has-sub-menu><a href=https://learncodestream.github.io/Configure/Endpoints/>Endpoints<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/Configure/Endpoints/bamboo/>Bamboo</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Docker/>Docker</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Docker-Registry/>Docker Registry</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Email/>Email</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Gerrit/>Gerrit</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Git/>Git</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Jenkins/>Jenkins</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Jira/>Jira</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Kubernetes/>Kubernetes</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/TFS/>TFS</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/vRealize-Orchestrator/>vRealize Orchestrator</a></li></ul></li><li><a href=https://learncodestream.github.io/Configure/variables/>Variables</a></li></ul></li><li class=has-sub-menu><a href=https://learncodestream.github.io/Triggers/>Triggers<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/Triggers/Gerrit/>Gerrit</a></li><li><a href=https://learncodestream.github.io/Triggers/Git/>Git</a></li><li><a href=https://learncodestream.github.io/Triggers/Docker/>Docker</a></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>