<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Kubernetes - Learn Code Stream</title><meta name=description content="VMware vRealize Automation"><meta name=generator content="Hugo 0.74.3"><link href=https://learncodestream.github.io/index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://learncodestream.github.io/Pipelines/Tasks/Kubernetes/><link rel=stylesheet href=https://learncodestream.github.io/css/theme.css><link rel=stylesheet href=/css/lightbox.min.css><link rel=stylesheet href=/css/custom.css><script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script><link rel=stylesheet href=https://learncodestream.github.io/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script><script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script src=https://learncodestream.github.io/js/bundle.js></script><script src=/js/lightbox.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-NN4VBNXV6M"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-NN4VBNXV6M');</script><style>:root{--custom-font-color: #0065ab;--custom-background-color: #FFFFFF}</style><meta property="og:title" content="Kubernetes"><meta property="og:description" content="The Kubernetes Task allows for interation and execution of Get, Create, Apply, Delete and Rollback actions against a Kubernetes Endpoint . You can use a Git Endpoint  for the YAML manifest definitions. The combination of Git Endpoints , use of a Git Triggers  and the Kubernetes task allows you to build complex Kubernetes application deployment strategies.
Common across all the Kubernetes actions is are:
 Kubernetes Cluster - the Kubernetes endpoint that the task will execute against Timeout - the task timeout while waiting for a response from Kubernetes, this can be useful if, for example, your deployment task needs to download several large container images that may exceed the default timeout, or your deployment has readiness checks that take time to return OK."><meta property="og:type" content="article"><meta property="og:url" content="https://learncodestream.github.io/Pipelines/Tasks/Kubernetes/"><meta property="og:image" content="https://learncodestream.github.io/images/og-image.png"><meta property="article:modified_time" content="2021-03-26T11:54:11+00:00"><meta property="og:site_name" content="Hugo Techdoc Theme"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://learncodestream.github.io/images/og-image.png"><meta name=twitter:title content="Kubernetes"><meta name=twitter:description content="The Kubernetes Task allows for interation and execution of Get, Create, Apply, Delete and Rollback actions against a Kubernetes Endpoint . You can use a Git Endpoint  for the YAML manifest definitions. The combination of Git Endpoints , use of a Git Triggers  and the Kubernetes task allows you to build complex Kubernetes application deployment strategies.
Common across all the Kubernetes actions is are:
 Kubernetes Cluster - the Kubernetes endpoint that the task will execute against Timeout - the task timeout while waiting for a response from Kubernetes, this can be useful if, for example, your deployment task needs to download several large container images that may exceed the default timeout, or your deployment has readiness checks that take time to return OK."><meta itemprop=name content="Kubernetes"><meta itemprop=description content="The Kubernetes Task allows for interation and execution of Get, Create, Apply, Delete and Rollback actions against a Kubernetes Endpoint . You can use a Git Endpoint  for the YAML manifest definitions. The combination of Git Endpoints , use of a Git Triggers  and the Kubernetes task allows you to build complex Kubernetes application deployment strategies.
Common across all the Kubernetes actions is are:
 Kubernetes Cluster - the Kubernetes endpoint that the task will execute against Timeout - the task timeout while waiting for a response from Kubernetes, this can be useful if, for example, your deployment task needs to download several large container images that may exceed the default timeout, or your deployment has readiness checks that take time to return OK."><meta itemprop=dateModified content="2021-03-26T11:54:11+00:00"><meta itemprop=wordCount content="872"><meta itemprop=image content="https://learncodestream.github.io/images/og-image.png"><meta itemprop=keywords content></head><body><div class=container><header><div class=header-image><img src=/images/vra-code-stream-logo.png alt="Learn Code Stream"></div><div class=header><div class=header-h1><h1 class=header-h1>Learn Code Stream</h1></div><div class=header-description><p class=description>VMware vRealize Automation</p></div></div></header><div class=content-container><main><h1>Kubernetes</h1><p>The Kubernetes Task allows for interation and execution of Get, Create, Apply, Delete and Rollback actions against a <a href=/Configure/Endpoints/Kubernetes>Kubernetes Endpoint
</a>. You can use a <a href=/Configure/Endpoints/Git>Git Endpoint</a> for the YAML manifest definitions. The combination of <a href=/Configure/Endpoints/Git>Git Endpoints
</a>, use of a <a href=/Triggers/Git>Git Triggers</a> and the Kubernetes task allows you to build complex Kubernetes application deployment strategies.</p><p>Common across all the Kubernetes actions is are:</p><ul><li><strong>Kubernetes Cluster</strong> - the Kubernetes endpoint that the task will execute against</li><li><strong>Timeout</strong> - the task timeout while waiting for a response from Kubernetes, this can be useful if, for example, your deployment task needs to download several large container images that may exceed the default timeout, or your deployment has readiness checks that take time to return OK.</li><li><strong>Source Type</strong><ul><li><em>Local definition</em> uses the YAML entered in the Local YAML Definition field - this allows you to use variables, properties and inputs directly in the YAML definition to customise the YAML</li><li><em>Source Control</em> uses the YAML loaded from a Git repository specified as a Git Endpoint, which can be customised by using variables in the YAML source file and parameters in the task configuration. e.g. by creating a YAML template with the <code>$${NAMESPACE}</code> variable below, the namespace name can be customised with a parameter:<div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w>    </span><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>v1<span class=w>
</span><span class=w>    </span><span class=k>kind</span><span class=p>:</span><span class=w> </span>Namespace<span class=w>
</span><span class=w>    </span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>name</span><span class=p>:</span><span class=w> </span>$${NAMESPACE}<span class=w>
</span></code></pre></div><div class=clr-content-image-wrap><a href=create-with-parameters.png data-lightbox=page-images data-title="YAML from Source Control, with Parameters"><img src=create-with-parameters.png alt="YAML from Source Control, with Parameters"></a><figcaption class=clr-caption>YAML from Source Control, with Parameters</figcaption></div></li></ul></li></ul><h2 id=actions>Actions</h2><p>There are five different actions you can perform against the Kubernetes endpoint.</p><div class=gdoc-tabs><input type=radio class="gdoc-tabs__control hidden" name="tabs-Kubernetes Task Actions" id="tabs-Kubernetes Task Actions-0" checked>
<label for="tabs-Kubernetes Task Actions-0" class=gdoc-tabs__label>Get</label><div class="gdoc-markdown--nested gdoc-tabs__content"><p>The Get action allows us to retrieve objects from Kubernetes based on a YAML specification - the minimum we need to specify is the object type, the name of the object and the namespace that the object resides, for example the query <code>kubectl get deployment controller --namespace metallb-system</code> translates to the following YAML:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>apps/v1<span class=w>
</span><span class=w></span><span class=k>kind</span><span class=p>:</span><span class=w> </span>Deployment<span class=w>
</span><span class=w></span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span>controller<span class=w>
</span><span class=w>  </span><span class=k>namespace</span><span class=p>:</span><span class=w> </span>metallb-system<span class=w>
</span></code></pre></div><div class=clr-content-image-wrap><a href=kubernetes-get-task.png data-lightbox=page-images data-title="Kubernetes Get Task"><img src=kubernetes-get-task.png alt="Kubernetes Get Task"></a><figcaption class=clr-caption>Kubernetes Get Task</figcaption></div><p>When the Kubernetes task runs the returned JSON object is accessible as part of the Task response object. This means that you can access properties of the requested object in subsequent tasks - e.g. to examine the number of deployments in the replica spec, I could access <code>${Stage0.Kubernetes.output.response.deployments.controller.spec.replicas}</code></p><div class=clr-content-image-wrap><a href=get-task-response.png data-lightbox=page-images data-title="Kubernetes Get Task Response"><img src=get-task-response.png alt="Kubernetes Get Task Response"></a><figcaption class=clr-caption>Kubernetes Get Task Response</figcaption></div></div><input type=radio class="gdoc-tabs__control hidden" name="tabs-Kubernetes Task Actions" id="tabs-Kubernetes Task Actions-1">
<label for="tabs-Kubernetes Task Actions-1" class=gdoc-tabs__label>Create</label><div class="gdoc-markdown--nested gdoc-tabs__content"><p>The Create action allows us to create objects based on a YAML specification, and as is common accross all tasks you can use locally defined or Git sourced YAML definitions. There is also an option to <strong>Continue on conflict</strong> - if enabled, and the object you are trying to create already exists, then the Task will not fail the Pipeline but continue on to the next Task or Stage. This can be useful if you want to ensure an object exists but you are not sure if it already does - a common example would be creating a <code>namespace</code>.</p><p>You <em>can</em> also use YAML files with multiple documents, separated with <code>---</code> to conform with YAML specifications - for example, the definition below creates two <code>namespace</code>:</p><blockquote class="gdoc-hint warning">Creating all the kubernetes resources with a single manifest file may be appropriate in some cases, however any failure of a single object creation will result in the whole task failing. If you need to respond to specific failures, or for ease of troubleshooting, it&rsquo;s normally a better idea to split the objects into multiple tasks and manifests.</blockquote><div class=clr-content-image-wrap><a href=create-multiple-ns.png data-lightbox=page-images data-title="Create multiple Kubernetes Namespaces"><img src=create-multiple-ns.png alt="Create multiple Kubernetes Namespaces"></a><figcaption class=clr-caption>Create multiple Kubernetes Namespaces</figcaption></div><p>When this Create task is executed, the response JSON will include responses for each object creation (or associated failure)</p><div class=clr-content-image-wrap><a href=create-multiple-ns-response.png data-lightbox=page-images data-title="Response for multiple Kubernetes Namespaces"><img src=create-multiple-ns-response.png alt="Response for multiple Kubernetes Namespaces"></a><figcaption class=clr-caption>Response for multiple Kubernetes Namespaces</figcaption></div></div><input type=radio class="gdoc-tabs__control hidden" name="tabs-Kubernetes Task Actions" id="tabs-Kubernetes Task Actions-2">
<label for="tabs-Kubernetes Task Actions-2" class=gdoc-tabs__label>Apply</label><div class="gdoc-markdown--nested gdoc-tabs__content"><p>The Apply action allows us to modify existing objects by applying an updated manifest YAML - this can be useful in a GitOps scenario when we are using Git as the single source of truth for an application. In this case when a YAML file is updated, a <a href=/Triggers/Git>Git Trigger</a> will start the pipeline and apply the updated YAML manifest to the existing object.</p><p>If we take the <code>namespace</code> from in the Create task, <code>ns-01</code>, and want to update the <code>metadata</code> with a <code>label</code> we can apply an updated manifest:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>v1<span class=w>
</span><span class=w></span><span class=k>kind</span><span class=p>:</span><span class=w> </span>Namespace<span class=w>
</span><span class=w></span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span>ns<span class=m>-01</span><span class=w>
</span><span class=w>  </span><span class=k>labels</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>app</span><span class=p>:</span><span class=w> </span>learn-code-stream<span class=w>
</span></code></pre></div><p>When this task executes, the response shows that the existing object has been updated with the new label:</p><div class=clr-content-image-wrap><a href=update-ns-label-result.png data-lightbox=page-images data-title="Updated namespace includes the label"><img src=update-ns-label-result.png alt="Updated namespace includes the label"></a><figcaption class=clr-caption>Updated namespace includes the label</figcaption></div></div><input type=radio class="gdoc-tabs__control hidden" name="tabs-Kubernetes Task Actions" id="tabs-Kubernetes Task Actions-3">
<label for="tabs-Kubernetes Task Actions-3" class=gdoc-tabs__label>Delete</label><div class="gdoc-markdown--nested gdoc-tabs__content"><p>The Delete action allows us to delete objects from Kubernetes based on a YAML specification - as with the Get action we need to specify enough information to identify the object we wish to delete. Most often, this is the object type, the name of the object and the namespace that the object resides - however to delete the namespace we created in the previous task we would use <code>kubectl delete namespace ns-01</code>, which translates to the following YAML:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>apiVersion</span><span class=p>:</span><span class=w> </span>v1<span class=w>
</span><span class=w></span><span class=k>kind</span><span class=p>:</span><span class=w> </span>Namespace<span class=w>
</span><span class=w></span><span class=k>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>name</span><span class=p>:</span><span class=w> </span>ns<span class=m>-01</span><span class=w>
</span></code></pre></div><p>When executed, the task succeeds if the object has been removed and fails if the deletion fails. The JSON output will reflect the new status:</p><div class=clr-content-image-wrap><a href=delete-success.png data-lightbox=page-images data-title="Successfully deleted"><img src=delete-success.png alt="Successfully deleted"></a><figcaption class=clr-caption>Successfully deleted</figcaption></div></div><input type=radio class="gdoc-tabs__control hidden" name="tabs-Kubernetes Task Actions" id="tabs-Kubernetes Task Actions-4">
<label for="tabs-Kubernetes Task Actions-4" class=gdoc-tabs__label>Rollback</label><div class="gdoc-markdown--nested gdoc-tabs__content"><p>The Rollback action relates to the management of <code>deployment</code>, <code>statefulset</code> and <code>daemonset</code> objects in kubernetes. Whenever the Pod template (<code>.spec.template</code>) properties for these objects are modified a rollout is triggered and a record of the previous state is recorded so that you can roll back to a previous state if required. The Rollback action allows you trigger a rollback to one of the previous five states and would typically be used to recover from a failed update to an existing <code>deployment</code>, <code>statefulset</code> or <code>daemonset</code>.</p><div class=clr-content-image-wrap><a href=rollback-deployment.png data-lightbox=page-images data-title="Rollback the controller deployment to the previous version"><img src=rollback-deployment.png alt="Rollback the controller deployment to the previous version"></a><figcaption class=clr-caption>Rollback the controller deployment to the previous version</figcaption></div></div></div><h2 id=links-and-references>Links and References</h2><ul><li><a href=https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-back-a-deployment target=_blank><i class="fa fa-external-link-alt fa-sm" aria-hidden=true></i>Rolling Back a Deployment</a></li></ul><div class=edit-meta>Last updated on 26 Mar 2021<br><a href=https://github.com/cmbu-tmm-sites/learncodestream/edit/main/content/Pipelines/Tasks/Kubernetes/index.md class=edit-page><i class="fas fa-pen-square"></i>&nbsp;Edit on GitHub</a></div><nav class=pagination><a class="nav nav-prev" href=https://learncodestream.github.io/Pipelines/Tasks/Jenkins/ title=Jenkins><i class="fas fa-arrow-left" aria-hidden=true></i>&nbsp;Prev - Jenkins</a>
<a class="nav nav-next" href=https://learncodestream.github.io/Pipelines/Tasks/Pipeline/ title=Pipeline>Next - Pipeline <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><nav class=slide-menu><ul><li><a href=https://learncodestream.github.io>Home</a></li><li class=has-sub-menu><a href=https://learncodestream.github.io/Getting-Started/>Getting Started<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/Getting-Started/Slack-Notifications/>Slack Notifications</a></li></ul></li><li><a href=https://learncodestream.github.io/Dashboards/>Dashboards</a></li><li><a href=https://learncodestream.github.io/Executions/>Executions</a></li><li><a href=https://learncodestream.github.io/User-Operations/>User Operations</a></li><li class="parent has-sub-menu"><a href=https://learncodestream.github.io/Pipelines/>Pipelines<span class="mark opened">-</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/Pipelines/Stages/>Stages</a></li><li class="parent has-sub-menu"><a href=https://learncodestream.github.io/Pipelines/Tasks/>Tasks<span class="mark opened">-</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/Pipelines/Tasks/bamboo/>Bamboo</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/CI/>CI</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/Condition/>Condition</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/Custom/>Custom</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/Jenkins/>Jenkins</a></li><li class=active><a href=https://learncodestream.github.io/Pipelines/Tasks/Kubernetes/>Kubernetes</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/Pipeline/>Pipeline</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/Poll/>Poll</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/PowerShell/>PowerShell</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/REST/>REST</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/SSH/>SSH</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/User-Operation/>User Operation</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/Cloud-Template/>VMware Cloud Template</a></li><li><a href=https://learncodestream.github.io/Pipelines/Tasks/vRealize-Orchestrator/>vRealize Orchestrator</a></li></ul></li></ul></li><li><a href=https://learncodestream.github.io/Custom-Integrations/>Custom Integrations</a></li><li class=has-sub-menu><a href=https://learncodestream.github.io/Configure/>Configure<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/Configure/Projects/>Projects</a></li><li class=has-sub-menu><a href=https://learncodestream.github.io/Configure/Endpoints/>Endpoints<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/Configure/Endpoints/bamboo/>Bamboo</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Docker/>Docker</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Docker-Registry/>Docker Registry</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Email/>Email</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Gerrit/>Gerrit</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Git/>Git</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Jenkins/>Jenkins</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Jira/>Jira</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/Kubernetes/>Kubernetes</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/TFS/>TFS</a></li><li><a href=https://learncodestream.github.io/Configure/Endpoints/vRealize-Orchestrator/>vRealize Orchestrator</a></li></ul></li><li><a href=https://learncodestream.github.io/Configure/variables/>Variables</a></li></ul></li><li class=has-sub-menu><a href=https://learncodestream.github.io/Triggers/>Triggers<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/Triggers/Gerrit/>Gerrit</a></li><li><a href=https://learncodestream.github.io/Triggers/Git/>Git</a></li><li><a href=https://learncodestream.github.io/Triggers/Docker/>Docker</a></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i><i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>