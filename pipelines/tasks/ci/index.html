<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>CI - Learn Code Stream</title><meta name=description content="VMware vRealize Automation"><meta name=generator content="Hugo 0.83.1"><link href=https://learncodestream.github.io/index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://learncodestream.github.io/pipelines/tasks/ci/><link rel=stylesheet href=https://learncodestream.github.io/css/theme.css><link rel=stylesheet href=/css/lightbox.min.css><link rel=stylesheet href=/css/custom.css><script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script><link rel=stylesheet href=https://learncodestream.github.io/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script><script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script src=https://learncodestream.github.io/js/bundle.js></script><script src=/js/lightbox.min.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-NN4VBNXV6M"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-NN4VBNXV6M')</script><style>:root{--custom-font-color:#0065ab;--custom-background-color:#FFFFFF}</style><meta property="og:title" content="CI"><meta property="og:description" content="The CI task enables almost any action in your pipeline by pulling a specific Docker image from a registry endpoint, and deploying it to a Docker host configured as an Endpoint. It then executes the CI task script in the context of the running container. It is an incredibly powerful and flexible task type, because the image can have almost any tool or program in it.
The CI task runs using parameters configured in the Pipeline Workspace configuration , including the Container Image, Docker Registry, Docker Host, directory, cache, environment variables and CPU/Memory limits."><meta property="og:type" content="article"><meta property="og:url" content="https://learncodestream.github.io/pipelines/tasks/ci/"><meta property="og:image" content="https://learncodestream.github.io/images/vra-code-stream-logo.png"><meta property="article:section" content="Pipelines"><meta property="article:modified_time" content="2022-04-26T14:56:20+01:00"><meta property="og:site_name" content="Learn Code Stream"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://learncodestream.github.io/images/vra-code-stream-logo.png"><meta name=twitter:title content="CI"><meta name=twitter:description content="The CI task enables almost any action in your pipeline by pulling a specific Docker image from a registry endpoint, and deploying it to a Docker host configured as an Endpoint. It then executes the CI task script in the context of the running container. It is an incredibly powerful and flexible task type, because the image can have almost any tool or program in it.
The CI task runs using parameters configured in the Pipeline Workspace configuration , including the Container Image, Docker Registry, Docker Host, directory, cache, environment variables and CPU/Memory limits."><meta itemprop=name content="CI"><meta itemprop=description content="The CI task enables almost any action in your pipeline by pulling a specific Docker image from a registry endpoint, and deploying it to a Docker host configured as an Endpoint. It then executes the CI task script in the context of the running container. It is an incredibly powerful and flexible task type, because the image can have almost any tool or program in it.
The CI task runs using parameters configured in the Pipeline Workspace configuration , including the Container Image, Docker Registry, Docker Host, directory, cache, environment variables and CPU/Memory limits."><meta itemprop=dateModified content="2022-04-26T14:56:20+01:00"><meta itemprop=wordCount content="549"><meta itemprop=image content="https://learncodestream.github.io/images/vra-code-stream-logo.png"><meta itemprop=keywords content></head><body><div class=container><header><div class=header-image><img src=/images/vra-code-stream-logo.png alt="Learn Code Stream"></div><div class=header><div class=header-h1><h1 class=header-h1>Learn Code Stream</h1></div><div class=header-description><p class=description>VMware vRealize Automation</p></div></div></header><div class=content-container><main><h1>CI</h1><p>The CI task enables almost any action in your pipeline by pulling a specific Docker image from a registry endpoint, and deploying it to a Docker host configured as an Endpoint. It then executes the CI task script in the context of the running container. It is an incredibly powerful and flexible task type, because the image can have almost any tool or program in it.</p><p>The CI task runs using parameters configured in the <a href=/pipelines/#pipeline-configuration>Pipeline Workspace configuration
</a>, including the Container Image, Docker Registry, Docker Host, directory, cache, environment variables and CPU/Memory limits.</p><p>The CI task container will run for the lifespan of the entire pipeline, so subsequent CI tasks within a pipeline will be executed in the same environment - this means that you can, for example, write files in container that will be preserved between Tasks.</p><p>If a Pipeline has been executed from a <a href>Git Trigger
</a>, and has been <a href=/pipelines/#pipeline-configuration>configured to clone the repository with the correct inputs
</a>, the Git repository will be automatically cloned into the Working Directory.</p><h2 id=creating-a-ci-task>Creating a CI task</h2><p>As well as the <a href=/pipelines/tasks/#common-configuration>common configurations</a> available to all tasks, the CI task has:</p><ul><li><strong>Steps</strong> - the script to execute in the container</li><li><strong>Preserve artifacts</strong> - the paths of artifacts to preserve in the shared path (on the docker host) - e.g. a compiled binary, configuration file or SSH key</li><li><strong>Export</strong> - exported variable names to be made available to the Pipeline after the task executes</li><li><strong>Process configurations</strong> - configuration elements for JUnit, JaCoCo, Checkstyle, FindBugs processing</li></ul><h3 id=steps>Steps</h3><p>The steps stage is essentially a Shell script that will be executed on the CI container image. This means it&rsquo;s relatively easy to convert any exisitng Shell scripts into a repeatable CI task by using <a href>Pipeline Inputs
</a>, <a href>variables
</a>, and <a href=/pipelines/#variables-in-pipelines>pipeline variable binding
</a>.</p><div class=clr-content-image-wrap><a href=bash-steps.png data-lightbox=page-images data-title="An example CI Task steps"><img src=bash-steps.png alt="An example CI Task steps"></a><figcaption class=clr-caption>An example CI Task steps</figcaption></div><h3 id=preserve-artifacts>Preserve Artifacts</h3><p>Artifacts (files) specified here will be stored in a shared folder on the docker host configured in the pipeline workspace. the below image shows a task where the ssh files are moved into the working directory (configured on the workspace tab of the pipeline). Then the file names provided for the &ldquo;Preserve artifacts&rdquo; configuration under the Steps code space.</p><p><img src=https://user-images.githubusercontent.com/22192242/123684497-70b22c00-d845-11eb-9b9e-19aeedaf1a1a.png alt=image></p><p>The full path of the preserved file will be available in the Task output JSON for later use. If, for example, my CI task writes to a file &ldquo;preserve.txt&rdquo; and specifies the file name/path in the Perserve Artifacts setting, the full path to &ldquo;preserve.txt&rdquo; will be available in <code>${Stage0.Task0.output.artifacts[0]}</code></p><div class=clr-content-image-wrap><a href=preserve-artifacts.png data-lightbox=page-images data-title="Preserved Artifact Path in Output JSON"><img src=preserve-artifacts.png alt="Preserved Artifact Path in Output JSON"></a><figcaption class=clr-caption>Preserved Artifact Path in Output JSON</figcaption></div><h3 id=exports>Exports</h3><p>You can use the Exports feature when you want the result of a CI task to be available to the Pipeline. These are <em>simple</em> string exports that must be compatible with the JSON output format that the task returns. Exporting multiline strings, for example, does not export correctly.</p><p>An example use might be a <code>BUILDTIME</code> variable that will be used in naming throughout the pipeline - in the CI task steps the variable must be declared with the <code>export</code> keyword:</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=nb>export</span> <span class=nv>BUILDTIME</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>date <span class=s2>&#34;+%y%m%d-%h%m%s&#34;</span><span class=k>)</span><span class=s2>&#34;</span>
</code></pre></div><p>Then the <code>BUILDTIME</code> variable can be added to the Export list and accessed later using <a href=/pipelines/#variables-in-pipelines>Pipeline Variable Binding</a></p><div class=clr-content-image-wrap><a href=export-variable.png data-lightbox=page-images data-title="Export BUILDTIME variable from a CI task"><img src=export-variable.png alt="Export BUILDTIME variable from a CI task"></a><figcaption class=clr-caption>Export BUILDTIME variable from a CI task</figcaption></div><h2 id=links-and-references>Links and References</h2><ul><li><a href=https://docs.vmware.com/en/VMware-Code-Stream/services/Using-and-Managing-CodeStream/GUID-5094086E-AF44-456D-AB35-6853FB780F42.html target=_blank><i class="fa fa-external-link-alt fa-sm" aria-hidden=true></i> What variables and expressions can I use when binding pipeline tasks in VMware Code Stream</a></li></ul><div class=edit-meta>Last updated on 26 Apr 2022<br><a href=https://github.com/cmbu-tmm-sites/learncodestream/edit/main/content/Pipelines/Tasks/CI/index.md class=edit-page><i class="fas fa-pen-square"></i>&nbsp;Edit on GitHub</a></div><nav class=pagination><a class="nav nav-prev" href=https://learncodestream.github.io/pipelines/tasks/bamboo/ title=Bamboo><i class="fas fa-arrow-left" aria-hidden=true></i>&nbsp;Prev - Bamboo</a>
<a class="nav nav-next" href=https://learncodestream.github.io/pipelines/tasks/condition/ title=Condition>Next - Condition <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme adapted from <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><nav class=slide-menu><ul><li><a href=https://learncodestream.github.io>Home</a></li><li><a href=https://learncodestream.github.io/getting-started/>Getting Started</a></li><li><a href=https://learncodestream.github.io/dashboards/>Dashboards</a></li><li><a href=https://learncodestream.github.io/executions/>Executions</a></li><li><a href=https://learncodestream.github.io/user-operations/>User Operations</a></li><li class="parent has-sub-menu"><a href=https://learncodestream.github.io/pipelines/>Pipelines<span class="mark opened">-</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/pipelines/stages/>Stages</a></li><li class="parent has-sub-menu"><a href=https://learncodestream.github.io/pipelines/tasks/>Tasks<span class="mark opened">-</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/pipelines/tasks/bamboo/>Bamboo</a></li><li class=active><a href=https://learncodestream.github.io/pipelines/tasks/ci/>CI</a></li><li><a href=https://learncodestream.github.io/pipelines/tasks/condition/>Condition</a></li><li><a href=https://learncodestream.github.io/pipelines/tasks/custom/>Custom</a></li><li><a href=https://learncodestream.github.io/pipelines/tasks/jenkins/>Jenkins</a></li><li><a href=https://learncodestream.github.io/pipelines/tasks/kubernetes/>Kubernetes</a></li><li><a href=https://learncodestream.github.io/pipelines/tasks/pipeline/>Pipeline</a></li><li><a href=https://learncodestream.github.io/pipelines/tasks/poll/>Poll</a></li><li><a href=https://learncodestream.github.io/pipelines/tasks/powershell/>PowerShell</a></li><li><a href=https://learncodestream.github.io/pipelines/tasks/rest/>REST</a></li><li><a href=https://learncodestream.github.io/pipelines/tasks/ssh/>SSH</a></li><li><a href=https://learncodestream.github.io/pipelines/tasks/user-operation/>User Operation</a></li><li><a href=https://learncodestream.github.io/pipelines/tasks/cloud-template/>VMware Cloud Template</a></li><li><a href=https://learncodestream.github.io/pipelines/tasks/vrealize-orchestrator/>vRealize Orchestrator</a></li></ul></li></ul></li><li><a href=https://learncodestream.github.io/custom-integrations/>Custom Integrations</a></li><li class=has-sub-menu><a href=https://learncodestream.github.io/configure/>Configure<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/configure/projects/>Projects</a></li><li class=has-sub-menu><a href=https://learncodestream.github.io/configure/endpoints/>Endpoints<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/configure/endpoints/bamboo/>Bamboo</a></li><li><a href=https://learncodestream.github.io/configure/endpoints/docker/>Docker</a></li><li><a href=https://learncodestream.github.io/configure/endpoints/docker-registry/>Docker Registry</a></li><li><a href=https://learncodestream.github.io/configure/endpoints/email/>Email</a></li><li><a href=https://learncodestream.github.io/configure/endpoints/gerrit/>Gerrit</a></li><li><a href=https://learncodestream.github.io/configure/endpoints/git/>Git</a></li><li><a href=https://learncodestream.github.io/configure/endpoints/jenkins/>Jenkins</a></li><li><a href=https://learncodestream.github.io/configure/endpoints/jira/>Jira</a></li><li><a href=https://learncodestream.github.io/configure/endpoints/kubernetes/>Kubernetes</a></li><li><a href=https://learncodestream.github.io/configure/endpoints/tfs/>TFS</a></li><li><a href=https://learncodestream.github.io/configure/endpoints/vrealize-orchestrator/>vRealize Orchestrator</a></li></ul></li><li><a href=https://learncodestream.github.io/configure/variables/>Variables</a></li></ul></li><li class=has-sub-menu><a href=https://learncodestream.github.io/triggers/>Triggers<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/triggers/gerrit/>Gerrit</a></li><li><a href=https://learncodestream.github.io/triggers/git/>Git</a></li><li><a href=https://learncodestream.github.io/triggers/docker/>Docker</a></li></ul></li><li class=has-sub-menu><a href=https://learncodestream.github.io/learn-in-5/>Learn in 5<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://learncodestream.github.io/learn-in-5/adding-a-kubernetes-endpoint/>Adding a Kubernetes Endpoint</a></li><li><a href=https://learncodestream.github.io/learn-in-5/publishing-preserved-artifacts/>Publishing Preserved Artifacts</a></li><li><a href=https://learncodestream.github.io/learn-in-5/slack-notifications/>Slack Notifications</a></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>